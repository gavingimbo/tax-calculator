<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Settlement Pro</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root {
            --background: 0 0% 100%;
            --foreground: 240 10% 3.9%;
            --card: 0 0% 100%;
            --primary: 240 5.9% 10%;
            --input: 240 5.9% 90%;
            --ring: 240 5.9% 10%;
            --radius: 0.75rem;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #fcfcfc;
            color: hsl(var(--foreground));
            -webkit-font-smoothing: antialiased;
            height: 100dvh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* --- UTILS --- */
        .tabular { font-variant-numeric: tabular-nums; }
        .tracking-tight { letter-spacing: -0.025em; }
        
        /* --- COMPONENTS --- */
        .card-shell {
            width: 100%;
            max-width: 420px;
            background: hsl(var(--card));
            border: 1px solid #e4e4e7;
            border-radius: var(--radius);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.02), 0 8px 10px -6px rgb(0 0 0 / 0.02);
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            max-height: 90vh; 
        }

        /* Responsive Mobile Override */
        @media (max-width: 640px) {
            body { align-items: flex-start; background: #fff; }
            .card-shell {
                max-width: 100%;
                max-height: 100dvh;
                height: 100dvh;
                border: none;
                border-radius: 0;
                box-shadow: none;
            }
        }

        .content-scroll {
            flex: 1;
            overflow-y: auto;
            scrollbar-width: none; 
            -ms-overflow-style: none;
        }
        .content-scroll::-webkit-scrollbar { display: none; }

        .shadcn-input {
            height: 2.75rem;
            width: 100%;
            border-radius: 0.5rem;
            border: 1px solid hsl(var(--input));
            background: transparent;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            outline: none;
        }
        
        .shadcn-input:focus {
            border-color: hsl(var(--ring));
            box-shadow: 0 0 0 2px hsl(var(--background)), 0 0 0 4px hsl(var(--input));
        }

        /* --- ANIMATIONS --- */
        .accordion-content {
            height: 0;
            overflow: hidden;
            transition: height 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Entitlement Card Animation */
        @keyframes cardSlideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .entitlement-card {
            animation: cardSlideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        
        /* Toggle Switch */
        .switch-root {
            width: 44px;
            height: 24px;
            background-color: hsl(var(--input));
            border-radius: 9999px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .switch-root[data-state="checked"] {
            background-color: hsl(var(--primary));
        }
        .switch-thumb {
            display: block;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 9999px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transform: translateX(2px) translateY(2px);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .switch-root[data-state="checked"] .switch-thumb {
            transform: translateX(22px) translateY(2px);
        }

        /* Diplomat Styles */
        .is-diplomat .tax-row {
            opacity: 0.3;
            text-decoration: line-through;
            pointer-events: none;
        }
        .is-diplomat .tax-row.active {
            opacity: 1;
            text-decoration: none;
            color: hsl(var(--primary));
            font-weight: 600;
        }
    </style>
</head>
<body>

    <div class="card-shell" id="app">
        
        <div class="px-6 py-5 border-b border-zinc-100 flex items-center justify-between bg-white/80 backdrop-blur-sm sticky top-0 z-20">
            <div class="flex items-center gap-2.5">
                <div class="bg-zinc-900 text-white p-1 rounded-md">
                    <i data-lucide="calculator" class="w-3.5 h-3.5"></i>
                </div>
                <span class="text-sm font-semibold tracking-tight text-zinc-900">Settlement</span>
            </div>
            
            <div class="flex items-center gap-3">
                <label class="text-[11px] font-medium text-zinc-500 uppercase tracking-wider cursor-pointer" for="modeSwitch">Diplomat</label>
                <div class="switch-root" id="modeSwitch" data-state="unchecked" onclick="toggleMode()">
                    <span class="switch-thumb"></span>
                </div>
            </div>
        </div>

        <div class="content-scroll">
            <div class="p-6 space-y-8 pb-10">
                
                <div class="space-y-2 text-center py-4">
                    <p class="text-xs font-semibold text-zinc-400 uppercase tracking-widest">Total Payable</p>
                    <h1 class="text-6xl font-bold tracking-tighter text-zinc-900 tabular" id="heroTotal">0.00</h1>
                    
                    <div id="badgeContainer" class="h-6 flex justify-center items-center opacity-0 transition-opacity duration-300">
                        <span class="inline-flex items-center gap-1.5 rounded-full border border-zinc-200 bg-zinc-50 px-2.5 py-0.5 text-[10px] font-bold uppercase tracking-widest text-zinc-600">
                            <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span>
                            Active
                        </span>
                    </div>
                </div>

                <div class="grid gap-5">
                    <div class="space-y-2">
                        <label class="text-xs font-medium text-zinc-500 ml-1">Bill Amount</label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 font-medium text-sm">LKR</span>
                            <input type="number" id="baseIn" placeholder="0.00" inputmode="decimal" oninput="calculate()" class="shadcn-input pl-12 font-semibold text-lg text-zinc-900">
                        </div>
                    </div>

                    <div class="space-y-2">
                        <div class="flex justify-between items-center px-1">
                            <label class="text-xs font-medium text-zinc-500">Discount</label>
                            <button onclick="toggleDiscMode()" id="discToggle" class="text-[10px] font-bold bg-zinc-100 hover:bg-zinc-200 text-zinc-600 px-2 py-0.5 rounded transition-colors">% Mode</button>
                        </div>
                        <input type="number" id="discIn" placeholder="Optional" inputmode="decimal" oninput="calculate()" class="shadcn-input font-medium text-zinc-900">
                    </div>
                </div>

                <div class="pt-4 border-t border-zinc-100">
                    
                    <div id="discRow" class="hidden flex justify-between items-center py-2 mb-2 text-rose-600 bg-rose-50/50 px-2 rounded-md border border-rose-100/50">
                        <span class="text-xs font-semibold">Discount Applied</span>
                        <span class="text-xs font-bold tabular">-<span id="discDisplay">0.00</span></span>
                    </div>

                    <div class="flex justify-between items-center py-2 px-1">
                        <span class="text-xs font-semibold text-zinc-700">Net / Tax Base</span>
                        <span id="subDisplay" class="text-sm font-semibold tabular text-zinc-900">0.00</span>
                    </div>

                    <button onclick="toggleDetails()" class="w-full flex items-center justify-between py-3 px-1 group cursor-pointer select-none">
                        <span class="text-xs font-medium text-zinc-400 group-hover:text-zinc-700 transition-colors flex items-center gap-1.5">
                            Tax Breakdown
                            <i id="chevron" data-lucide="chevron-down" class="w-3 h-3 transition-transform duration-300"></i>
                        </span>
                        <div class="h-px flex-1 bg-zinc-100 mx-3"></div>
                        <span id="taxTotalDisplay" class="text-xs font-medium text-zinc-400 tabular group-hover:text-zinc-700 transition-colors">0.00</span>
                    </button>

                    <div id="taxDetails" class="accordion-content">
                        <div class="px-1 space-y-2 pb-2 pt-1">
                            <div class="flex justify-between text-xs text-zinc-500 tax-row active">
                                <span>Service Charge (10%)</span>
                                <span id="scVal" class="tabular font-medium text-zinc-700">0.00</span>
                            </div>
                            <div class="flex justify-between text-xs text-zinc-500 tax-row active">
                                <span>TDL (1.04%)</span>
                                <span id="tdlVal" class="tabular font-medium text-zinc-700">0.00</span>
                            </div>
                            <div class="flex justify-between text-xs text-zinc-500 tax-row transition-opacity duration-300">
                                <span>SSCL (2.56%)</span>
                                <span id="sscVal" class="tabular font-medium text-zinc-700">0.00</span>
                            </div>
                            <div class="flex justify-between text-xs text-zinc-500 tax-row transition-opacity duration-300">
                                <span>VAT (18%)</span>
                                <span id="vatVal" class="tabular font-medium text-zinc-700">0.00</span>
                            </div>
                        </div>
                    </div>

                    <div id="savingsRow" class="hidden mt-6">
                        <div class="entitlement-card relative overflow-hidden rounded-xl bg-zinc-900 p-4 shadow-xl shadow-zinc-200 border border-zinc-800">
                            <div class="absolute -top-10 -right-10 h-24 w-24 bg-yellow-500/10 blur-3xl rounded-full pointer-events-none"></div>
                            
                            <div class="relative flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="flex h-9 w-9 items-center justify-center rounded-lg bg-gradient-to-br from-yellow-400/20 to-yellow-600/10 text-yellow-400 ring-1 ring-yellow-500/30">
                                        <i data-lucide="shield-check" class="h-5 w-5"></i>
                                    </div>
                                    <div class="flex flex-col">
                                        <p class="text-[9px] font-bold uppercase tracking-[0.2em] text-yellow-600/90 leading-tight mb-0.5">Entitlement</p>
                                        <p class="text-xs font-bold text-zinc-100 tracking-tight">Diplomatic Immunity</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-[9px] font-medium text-zinc-500 uppercase tracking-wider">Total Waived</p>
                                    <p id="waivedVal" class="text-lg font-bold tabular-nums text-yellow-400 tracking-tighter drop-shadow-sm">0.00</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            
            <div class="p-6 pt-0 mt-auto bg-white/80 backdrop-blur-sm sticky bottom-0 z-20 border-t border-zinc-50 sm:border-none sm:bg-transparent sm:backdrop-blur-none sm:static">
                <button onclick="resetAll()" class="w-full h-10 rounded-md border border-zinc-200 bg-white text-xs font-semibold text-zinc-600 hover:bg-zinc-50 hover:text-zinc-900 transition-all focus:ring-2 focus:ring-zinc-900 focus:ring-offset-2 outline-none shadow-sm">
                    Start New Settlement
                </button>
                <div class="text-center mt-5">
                     <p class="text-[9px] text-zinc-300 font-bold uppercase tracking-[0.25em]">Designed by Gavin</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        
        let state = {
            base: 0,
            discountInput: 0,
            discountMode: 'pct',
            isDiplomat: false,
            detailsOpen: false
        };

        const els = {
            app: document.getElementById('app'),
            switch: document.getElementById('modeSwitch'),
            badge: document.getElementById('badgeContainer'),
            discRow: document.getElementById('discRow'),
            details: document.getElementById('taxDetails'),
            chevron: document.getElementById('chevron'),
            savings: document.getElementById('savingsRow'),
            discToggle: document.getElementById('discToggle')
        };

        function toggleMode() {
            state.isDiplomat = !state.isDiplomat;
            
            if (state.isDiplomat) {
                els.switch.dataset.state = "checked";
                els.app.classList.add('is-diplomat');
                els.badge.classList.remove('opacity-0');
                els.savings.classList.remove('hidden');
                
                // Auto-open details to show crossed-out taxes
                if(!state.detailsOpen) toggleDetails(true);
            } else {
                els.switch.dataset.state = "unchecked";
                els.app.classList.remove('is-diplomat');
                els.badge.classList.add('opacity-0');
                els.savings.classList.add('hidden');
            }
            calculate();
        }

        function toggleDiscMode() {
            state.discountMode = state.discountMode === 'pct' ? 'lkr' : 'pct';
            els.discToggle.innerText = state.discountMode === 'pct' ? '% Mode' : 'LKR Mode';
            calculate();
        }

        function toggleDetails(forceOpen = false) {
            if (forceOpen) {
                state.detailsOpen = true;
            } else {
                state.detailsOpen = !state.detailsOpen;
            }

            if (state.detailsOpen) {
                els.details.style.height = els.details.scrollHeight + "px";
                els.chevron.style.transform = 'rotate(180deg)';
            } else {
                els.details.style.height = "0px";
                els.chevron.style.transform = 'rotate(0deg)';
            }
        }

        function resetAll() {
            document.getElementById('baseIn').value = '';
            document.getElementById('discIn').value = '';
            state.base = 0;
            state.discountInput = 0;
            if(state.isDiplomat) toggleMode(); 
            
            // Reset UI state
            state.detailsOpen = false;
            els.details.style.height = "0px";
            els.chevron.style.transform = 'rotate(0deg)';
            
            calculate();
        }

        function format(num) {
            return new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(num);
        }

        function calculate() {
            state.base = parseFloat(document.getElementById('baseIn').value) || 0;
            state.discountInput = parseFloat(document.getElementById('discIn').value) || 0;

            let discountValue = 0;
            if (state.base > 0 && state.discountInput > 0) {
                if (state.discountMode === 'pct') {
                    discountValue = state.base * (Math.min(state.discountInput, 100) / 100);
                } else {
                    discountValue = Math.min(state.discountInput, state.base);
                }
            }

            if (discountValue > 0) {
                els.discRow.classList.remove('hidden');
                document.getElementById('discDisplay').innerText = format(discountValue);
            } else {
                els.discRow.classList.add('hidden');
            }

            const subtotal = state.base - discountValue;
            document.getElementById('subDisplay').innerText = format(subtotal);

            // Taxes
            const sc = subtotal * 0.10;
            const tdl = subtotal * 0.0104; 
            const ssc = (subtotal + sc) * 0.025641;
            const vat = (subtotal + sc + ssc) * 0.18;

            document.getElementById('scVal').innerText = format(sc);
            document.getElementById('tdlVal').innerText = format(tdl);
            document.getElementById('sscVal').innerText = format(ssc);
            document.getElementById('vatVal').innerText = format(vat);

            let grandTotal = 0;
            let taxesSum = 0;

            if (state.isDiplomat) {
                grandTotal = subtotal + sc + tdl;
                taxesSum = sc + tdl; 
                document.getElementById('waivedVal').innerText = format(ssc + vat);
            } else {
                grandTotal = subtotal + sc + tdl + ssc + vat;
                taxesSum = sc + tdl + ssc + vat;
            }

            document.getElementById('heroTotal').innerText = format(grandTotal);
            document.getElementById('taxTotalDisplay').innerText = `+ ${format(taxesSum)}`;
            
            // Recalculate accordion height dynamically
            if (state.detailsOpen) {
                 els.details.style.height = "auto";
                 const newHeight = els.details.scrollHeight;
                 els.details.style.height = newHeight + "px";
            }
        }
    </script>
</body>
</html>
