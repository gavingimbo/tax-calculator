<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Calculator | Institutional Grade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root { --ring: rgba(9, 9, 11, 0.08); }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: #09090b;
            -webkit-font-smoothing: antialiased;
            overflow: hidden;
            height: 100dvh;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
        }

        /* Results Display (Top) */
        .display-pane {
            flex: 1;
            overflow-y: auto;
            padding: 2.5rem 1.5rem;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 200px; /* Space for console */
        }

        /* Interactive Console (Bottom) */
        .interaction-console {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-top: 1px solid #e4e4e7;
            padding: 1.25rem 1.25rem calc(1.25rem + env(safe-area-inset-bottom));
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }

        /* Elements */
        .input-group {
            background: #ffffff;
            border: 1px solid #e4e4e7;
            border-radius: 14px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .input-group:focus-within {
            border-color: #09090b;
            box-shadow: 0 0 0 4px var(--ring);
        }

        /* The Percentage/Fixed Toggle */
        .unit-toggle-container {
            background: #f4f4f5;
            padding: 2px;
            border-radius: 10px;
            display: flex;
            width: fit-content;
        }
        .unit-btn {
            padding: 6px 12px;
            font-size: 10px;
            font-weight: 700;
            border-radius: 8px;
            transition: all 0.2s;
            color: #71717a;
        }
        .unit-btn.active {
            background: #ffffff;
            color: #09090b;
            box-shadow: 0 1px 2px rgba(0,0,0,0.08);
        }

        .guest-tab {
            flex: 1;
            padding: 10px;
            font-size: 11px;
            font-weight: 600;
            text-align: center;
            border-radius: 10px;
            transition: all 0.2s;
            color: #71717a;
        }
        .guest-tab.active {
            background: #09090b;
            color: #ffffff;
        }

        /* Typography & Table */
        .tabular { font-variant-numeric: tabular-nums; }
        .row-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; }
        .row-label { font-size: 12px; color: #71717a; font-weight: 500; }
        .row-value { font-size: 12px; color: #09090b; font-weight: 600; }

        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input { background: transparent; outline: none; width: 100%; }

        /* Animations */
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="app-container" id="app">
        <div class="display-pane" id="scrollArea">
            <div class="space-y-10">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <div class="w-6 h-6 bg-zinc-900 rounded-md flex items-center justify-center">
                            <i data-lucide="percent" class="text-white w-3 h-3"></i>
                        </div>
                        <span class="text-[11px] font-bold uppercase tracking-[0.15em]">Calculator</span>
                    </div>
                    <div class="flex items-center gap-1.5 bg-zinc-100 px-2 py-1 rounded-full">
                        <span class="w-1.5 h-1.5 rounded-full bg-zinc-900"></span>
                        <span class="text-[9px] font-bold text-zinc-500 uppercase">Secure</span>
                    </div>
                </div>

                <div class="text-center space-y-2">
                    <p class="text-[10px] font-black text-zinc-400 uppercase tracking-[0.25em]">Total Amount Payable</p>
                    <div class="flex items-baseline justify-center gap-2">
                        <span id="grandTotal" class="text-6xl font-extrabold tracking-tighter tabular">0.00</span>
                        <span class="text-sm font-bold text-zinc-300">LKR</span>
                    </div>
                </div>

                <div class="bg-zinc-50/50 border border-zinc-100 rounded-3xl p-6 space-y-5">
                    <div class="flex justify-between items-center pb-2 border-b border-zinc-100">
                        <span class="text-xs font-bold text-zinc-400 uppercase tracking-widest">Breakdown</span>
                        <span id="taxableLabel" class="text-[10px] font-bold text-zinc-900 bg-white px-2 py-0.5 rounded border border-zinc-200 tabular">SUBTOTAL: 0.00</span>
                    </div>
                    
                    <div class="space-y-1">
                        <div class="row-item">
                            <span class="row-label">Service Charge (10%)</span>
                            <span id="scVal" class="row-value tabular">0.00</span>
                        </div>
                        <div class="row-item">
                            <span class="row-label">TDL (1.04%)</span>
                            <span id="tdlVal" class="row-value tabular">0.00</span>
                        </div>
                        <div id="sscRow" class="row-item transition-opacity duration-300">
                            <span class="row-label">SSCL (2.5641%)</span>
                            <span id="sscVal" class="row-value tabular">0.00</span>
                        </div>
                        <div id="vatRow" class="row-item transition-opacity duration-300">
                            <span class="row-label">VAT (18%)</span>
                            <span id="vatVal" class="row-value tabular">0.00</span>
                        </div>
                    </div>
                </div>

                <div id="diplomatCard" class="hidden fade-in">
                    <div class="bg-zinc-900 rounded-3xl p-6 text-white relative overflow-hidden">
                        <i data-lucide="crown" class="absolute -right-4 -bottom-4 w-24 h-24 text-white/5 -rotate-12"></i>
                        <p class="text-[9px] font-black uppercase tracking-[0.2em] text-zinc-500 mb-4">Diplomatic Exemption</p>
                        <div class="flex justify-between items-end">
                            <div class="space-y-1">
                                <p class="text-[10px] text-zinc-400">Total Savings</p>
                                <p id="totalExVal" class="text-2xl font-bold tabular">0.00 LKR</p>
                            </div>
                            <div class="text-right">
                                <p class="text-[10px] text-emerald-400 font-bold uppercase">VAT & SSC Waived</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pt-6 pb-4 text-center">
                    <p class="text-[10px] font-bold text-zinc-300 uppercase tracking-[0.15em] leading-relaxed">
                        Gavin Matthew. Not for distribution or resale.<br>
                        Local calculation only.
                    </p>
                </div>
            </div>
        </div>

        <div class="interaction-console space-y-4" id="console">
            <div class="flex bg-zinc-100 p-1 rounded-xl">
                <button onclick="setGuest('standard')" id="btnStandard" class="guest-tab active">Standard Guest</button>
                <button onclick="setGuest('diplomat')" id="btnDiplomat" class="guest-tab">Diplomat</button>
            </div>

            <div class="input-group px-4 py-4 flex items-center gap-3">
                <span class="text-[10px] font-black text-zinc-400 border-r pr-3 border-zinc-100">LKR</span>
                <input 
                    type="number" 
                    id="baseInput" 
                    oninput="calculate()" 
                    inputmode="decimal" 
                    placeholder="Enter base value" 
                    class="font-bold text-xl placeholder:text-zinc-200"
                >
            </div>

            <div class="input-group px-4 py-3 flex items-center justify-between">
                <div class="flex items-center gap-3 flex-1">
                    <i data-lucide="tag" class="w-4 h-4 text-zinc-300"></i>
                    <input 
                        type="number" 
                        id="discInput" 
                        oninput="calculate()" 
                        inputmode="decimal" 
                        placeholder="Add discount" 
                        class="font-semibold text-sm placeholder:text-zinc-200"
                    >
                </div>
                
                <div class="unit-toggle-container">
                    <button onclick="setDiscType('pct')" id="typePct" class="unit-btn active">%</button>
                    <button onclick="setDiscType('fixed')" id="typeFixed" class="unit-btn">LKR</button>
                </div>
            </div>

            <button onclick="fullReset()" class="w-full py-3 text-[10px] font-bold uppercase tracking-widest text-zinc-400 hover:text-zinc-900 transition-colors">
                Clear all fields
            </button>
        </div>
    </div>

    <script>
        lucide.createIcons();

        let guestType = 'standard';
        let discountType = 'pct'; // pct or fixed

        function setGuest(type) {
            guestType = type;
            document.getElementById('btnStandard').classList.toggle('active', type === 'standard');
            document.getElementById('btnDiplomat').classList.toggle('active', type === 'diplomat');
            
            const sscRow = document.getElementById('sscRow');
            const vatRow = document.getElementById('vatRow');
            const diplomatCard = document.getElementById('diplomatCard');

            if(type === 'diplomat') {
                sscRow.classList.add('opacity-10', 'pointer-events-none');
                vatRow.classList.add('opacity-10', 'pointer-events-none');
                diplomatCard.classList.remove('hidden');
            } else {
                sscRow.classList.remove('opacity-10', 'pointer-events-none');
                vatRow.classList.remove('opacity-10', 'pointer-events-none');
                diplomatCard.classList.add('hidden');
            }
            calculate();
        }

        function setDiscType(type) {
            discountType = type;
            document.getElementById('typePct').classList.toggle('active', type === 'pct');
            document.getElementById('typeFixed').classList.toggle('active', type === 'fixed');
            calculate();
        }

        function fullReset() {
            document.getElementById('baseInput').value = '';
            document.getElementById('discInput').value = '';
            calculate();
        }

        function format(num) {
            return new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(num);
        }

        function calculate() {
            const base = parseFloat(document.getElementById('baseInput').value) || 0;
            const discInput = parseFloat(document.getElementById('discInput').value) || 0;

            let discountValue = (discountType === 'pct') ? base * (discInput / 100) : discInput;
            const taxableSubtotal = Math.max(0, base - discountValue);

            // Cascade Math (as per hospitality standards in reference image)
            const serviceCharge = taxableSubtotal * 0.10;
            const tdl = taxableSubtotal * 0.0104; // 1% TDL + compounding effects
            const ssc = (taxableSubtotal + serviceCharge) * 0.025641; // SSCL rate
            const vat = (taxableSubtotal + serviceCharge + ssc) * 0.18; // 18% VAT

            // Update Breakdown UI
            document.getElementById('taxableLabel').innerText = `SUBTOTAL: ${format(taxableSubtotal)}`;
            document.getElementById('scVal').innerText = format(serviceCharge);
            document.getElementById('tdlVal').innerText = format(tdl);
            document.getElementById('sscVal').innerText = format(ssc);
            document.getElementById('vatVal').innerText = format(vat);

            let grandTotal = 0;
            if (guestType === 'standard') {
                grandTotal = taxableSubtotal + serviceCharge + tdl + ssc + vat;
            } else {
                grandTotal = taxableSubtotal + serviceCharge + tdl;
                // Exemption Logic
                document.getElementById('totalExVal').innerText = format(vat + ssc) + ' LKR';
            }

            document.getElementById('grandTotal').innerText = format(grandTotal);
        }

        // Viewport Handling for Mobile Keyboard
        if (window.visualViewport) {
            window.visualViewport.addEventListener('resize', () => {
                const app = document.getElementById('app');
                app.style.height = `${window.visualViewport.height}px`;
                
                // Auto-scroll to total when typing to keep result visible
                if (document.activeElement.tagName === 'INPUT') {
                    window.scrollTo(0,0);
                }
            });
        }
    </script>
</body>
</html>
