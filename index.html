<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Calculator Pro</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root {
            --radius: 0.5rem;
            --zinc-50: #fafafa;
            --zinc-100: #f4f4f5;
            --zinc-200: #e4e4e7;
            --zinc-900: #09090b;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: var(--zinc-900);
            -webkit-font-smoothing: antialiased;
            overflow: hidden;
            height: 100dvh;
        }

        /* --- SHADCN UI COMPONENT REPLICATION --- */
        .shadcn-input {
            display: flex;
            height: 2.5rem;
            width: 100%;
            border-radius: var(--radius);
            border: 1px solid var(--zinc-200);
            background-color: #ffffff;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            outline: none;
        }

        .shadcn-input:focus {
            border-color: var(--zinc-900);
            box-shadow: 0 0 0 2px rgba(9, 9, 11, 0.05);
        }

        .shadcn-input::placeholder { color: #71717a; }

        /* --- LAYOUT ENGINE --- */
        .app-shell {
            display: flex;
            flex-direction: column;
            height: 100%;
            max-width: 440px;
            margin: 0 auto;
        }

        .viewport-display {
            flex: 1;
            padding: 3.5rem 2rem 2rem;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .viewport-console {
            background: #ffffff;
            border-top: 1px solid var(--zinc-100);
            padding: 2rem 2rem calc(2rem + env(safe-area-inset-bottom));
            z-index: 100;
        }

        /* --- ANIMATIONS & STATES --- */
        .hero-total {
            font-size: 5.5rem;
            font-weight: 900;
            letter-spacing: -0.06em;
            line-height: 0.85;
            transition: all 0.3s ease;
        }

        .tabular { font-variant-numeric: tabular-nums; }

        .is-diplomat .exempt-line {
            opacity: 0.15;
            text-decoration: line-through;
            filter: grayscale(1);
        }

        /* Toggle Component */
        .toggle-container {
            background: var(--zinc-100);
            padding: 2px;
            border-radius: 8px;
            display: flex;
            position: relative;
        }
        .toggle-thumb {
            position: absolute;
            top: 2px; bottom: 2px; left: 2px;
            width: calc(50% - 2px);
            background: #fff;
            border-radius: 6px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .toggle-btn {
            flex: 1;
            z-index: 10;
            padding: 8px;
            font-size: 11px;
            font-weight: 600;
            color: #71717a;
            transition: color 0.2s;
        }
        .toggle-btn.active { color: var(--zinc-900); }

        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button {
            -webkit-appearance: none; margin: 0;
        }
    </style>
</head>
<body>

    <div class="app-shell" id="app">
        
        <div class="viewport-display space-y-12">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-zinc-900 rounded-sm"></div>
                    <span class="text-[10px] font-black uppercase tracking-[0.4em] text-zinc-400">Calculator</span>
                </div>
                <div id="statusBadge" class="hidden px-2 py-0.5 bg-emerald-50 text-emerald-600 text-[9px] font-bold uppercase tracking-widest rounded border border-emerald-100 animate-pulse">
                    Diplomat Active
                </div>
            </div>

            <div class="space-y-4 text-center">
                <div class="hero-total tabular" id="grandTotal">0.00</div>
                <p class="text-[10px] font-bold text-zinc-300 uppercase tracking-[0.4em]">Settlement Total LKR</p>
            </div>

            <div class="space-y-5 pt-4">
                
                <div id="discRow" class="hidden flex justify-between items-center text-[11px] text-rose-500 animate-in fade-in slide-in-from-top-1 duration-300">
                    <span class="font-bold uppercase tracking-wider">Discount Applied</span>
                    <span class="font-bold tabular">-<span id="discDisplayVal">0.00</span></span>
                </div>

                <div class="flex justify-between items-baseline border-b border-zinc-100 pb-3">
                    <span class="text-[10px] font-black uppercase tracking-[0.2em] text-zinc-400">Tax Audit / Net</span>
                    <span id="subVal" class="text-xs font-bold tabular">0.00</span>
                </div>

                <div class="space-y-3">
                    <div class="flex justify-between items-center text-[11px]">
                        <span class="font-medium text-zinc-400">Service Charge (10%)</span>
                        <span id="scVal" class="font-bold tabular">0.00</span>
                    </div>
                    <div class="flex justify-between items-center text-[11px]">
                        <span class="font-medium text-zinc-400">TDL (1.04%)</span>
                        <span id="tdlVal" class="font-bold tabular">0.00</span>
                    </div>
                    <div class="exempt-line flex justify-between items-center text-[11px] transition-all duration-500">
                        <span class="font-medium text-zinc-400">SSCL (2.5641%)</span>
                        <span id="sscVal" class="font-bold tabular">0.00</span>
                    </div>
                    <div class="exempt-line flex justify-between items-center text-[11px] transition-all duration-500">
                        <span class="font-medium text-zinc-400">VAT (18%)</span>
                        <span id="vatVal" class="font-bold tabular">0.00</span>
                    </div>
                </div>
                
                <div id="savingsRow" class="hidden pt-2">
                    <div class="flex justify-between items-center text-[11px] text-emerald-600 font-bold">
                        <span>Total Waived Amount</span>
                        <span id="waivedVal" class="tabular">0.00</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="viewport-console space-y-8">
            <div class="toggle-container">
                <div id="thumb" class="toggle-thumb"></div>
                <button onclick="setMode('standard')" id="btnStd" class="toggle-btn active">Standard Guest</button>
                <button onclick="setMode('diplomat')" id="btnDip" class="toggle-btn">Diplomat Exempt</button>
            </div>

            <div class="space-y-6">
                <div class="space-y-2">
                    <label class="text-[11px] font-bold uppercase tracking-widest text-zinc-400 ml-1">Base Value</label>
                    <input type="number" id="baseIn" placeholder="0.00" inputmode="decimal" oninput="calculate()" class="shadcn-input tabular font-semibold text-base">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <div class="flex justify-between items-center px-1">
                            <label class="text-[11px] font-bold uppercase tracking-widest text-zinc-400">Discount</label>
                            <button onclick="toggleDisc()" id="discType" class="text-[8px] font-black bg-zinc-900 text-white px-1.5 py-0.5 rounded-sm">%</button>
                        </div>
                        <input type="number" id="discIn" placeholder="0" inputmode="decimal" oninput="calculate()" class="shadcn-input tabular font-semibold text-base">
                    </div>
                    <div class="space-y-2 flex flex-col justify-end">
                        <button onclick="fullReset()" class="h-10 text-[10px] font-bold uppercase tracking-widest text-zinc-400 hover:text-zinc-900 transition-colors">Clear All</button>
                    </div>
                </div>
            </div>

            <footer class="text-center opacity-30">
                <p class="text-[9px] font-bold text-zinc-900 uppercase tracking-[0.4em]">Gavin Matthew</p>
            </footer>
        </div>
    </div>

    <script>
        lucide.createIcons();

        let guestMode = 'standard';
        let discMode = 'pct';

        function setMode(mode) {
            guestMode = mode;
            const thumb = document.getElementById('thumb');
            const btnStd = document.getElementById('btnStd');
            const btnDip = document.getElementById('btnDip');
            const app = document.getElementById('app');
            const badge = document.getElementById('statusBadge');
            const savings = document.getElementById('savingsRow');

            if (mode === 'diplomat') {
                thumb.style.transform = 'translateX(100%)';
                btnDip.classList.add('active');
                btnStd.classList.remove('active');
                app.classList.add('is-diplomat');
                badge.classList.remove('hidden');
                savings.classList.remove('hidden');
            } else {
                thumb.style.transform = 'translateX(0)';
                btnStd.classList.add('active');
                btnDip.classList.remove('active');
                app.classList.remove('is-diplomat');
                badge.classList.add('hidden');
                savings.classList.add('hidden');
            }
            calculate();
        }

        function toggleDisc() {
            discMode = (discMode === 'pct') ? 'lkr' : 'pct';
            document.getElementById('discType').innerText = (discMode === 'pct') ? '%' : 'LKR';
            calculate();
        }

        function fullReset() {
            document.getElementById('baseIn').value = '';
            document.getElementById('discIn').value = '';
            calculate();
        }

        function format(num) {
            return new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(num);
        }

        function calculate() {
            const base = parseFloat(document.getElementById('baseIn').value) || 0;
            const discInput = parseFloat(document.getElementById('discIn').value) || 0;

            // Discount Logic
            let dVal = 0;
            if (base > 0 && discInput > 0) {
                 dVal = (discMode === 'pct') ? base * (Math.min(discInput, 100) / 100) : Math.min(discInput, base);
            }
            
            // Subtotal
            const subtotal = base - dVal;

            // UI Update: Discount Row Visibility
            const discRow = document.getElementById('discRow');
            const discDisplay = document.getElementById('discDisplayVal');
            
            if (dVal > 0) {
                discRow.classList.remove('hidden');
                discDisplay.innerText = format(dVal);
            } else {
                discRow.classList.add('hidden');
            }

            // Cascading Taxes (SRI LANKAN HOSPITALITY STANDARD)
            const sc = subtotal * 0.10;
            const tdl = subtotal * 0.0104; 
            const ssc = (subtotal + sc) * 0.025641;
            const vat = (subtotal + sc + ssc) * 0.18;

            document.getElementById('subVal').innerText = format(subtotal);
            document.getElementById('scVal').innerText = format(sc);
            document.getElementById('tdlVal').innerText = format(tdl);
            document.getElementById('sscVal').innerText = format(ssc);
            document.getElementById('vatVal').innerText = format(vat);

            let total = (guestMode === 'standard') ? (subtotal + sc + tdl + ssc + vat) : (subtotal + sc + tdl);
            
            if (guestMode === 'diplomat') {
                document.getElementById('waivedVal').innerText = format(ssc + vat);
            }

            document.getElementById('grandTotal').innerText = format(total);
        }

        // Viewport handling
        if (window.visualViewport) {
            window.visualViewport.addEventListener('resize', () => {
                document.getElementById('app').style.height = `${window.visualViewport.height}px`;
            });
        }
    </script>
</body>
</html>
