<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Settlement Pro</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root {
            /* Shadcn/UI Base Variables */
            --background: 0 0% 100%;
            --foreground: 240 10% 3.9%;
            --card: 0 0% 100%;
            --card-foreground: 240 10% 3.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 240 10% 3.9%;
            --primary: 240 5.9% 10%;
            --primary-foreground: 0 0% 98%;
            --secondary: 240 4.8% 95.9%;
            --secondary-foreground: 240 5.9% 10%;
            --muted: 240 4.8% 95.9%;
            --muted-foreground: 240 3.8% 46.1%;
            --accent: 240 4.8% 95.9%;
            --accent-foreground: 240 5.9% 10%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 0 0% 98%;
            --border: 240 5.9% 90%;
            --input: 240 5.9% 90%;
            --ring: 240 5.9% 10%;
            --radius: 0.75rem;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #fcfcfc;
            color: hsl(var(--foreground));
            -webkit-font-smoothing: antialiased;
            height: 100dvh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* --- UTILS --- */
        .tabular { font-variant-numeric: tabular-nums; }
        .tracking-tight { letter-spacing: -0.025em; }
        
        /* --- COMPONENTS --- */
        .card-shell {
            width: 100%;
            max-width: 420px;
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.02), 0 8px 10px -6px rgb(0 0 0 / 0.02);
            overflow: hidden;
            position: relative;
            transition: height 0.3s ease;
        }

        /* Responsive Mobile Override */
        @media (max-width: 640px) {
            body { align-items: flex-start; background: #fff; }
            .card-shell {
                max-width: 100%;
                height: 100dvh;
                border: none;
                border-radius: 0;
                box-shadow: none;
                display: flex;
                flex-direction: column;
            }
            .content-scroll {
                flex: 1;
                overflow-y: auto;
            }
        }

        .input-group {
            position: relative;
            transition: all 0.2s;
        }

        .shadcn-input {
            height: 2.75rem;
            width: 100%;
            border-radius: 0.5rem;
            border: 1px solid hsl(var(--input));
            background: transparent;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            outline: none;
        }
        
        .shadcn-input:focus {
            border-color: hsl(var(--ring));
            box-shadow: 0 0 0 2px hsl(var(--background)), 0 0 0 4px hsl(var(--input));
        }

        /* Accordion Animation */
        .accordion-content {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.3s ease-out;
        }
        .accordion-content.open {
            grid-template-rows: 1fr;
        }
        .accordion-inner {
            overflow: hidden;
        }

        /* Toggle Switch */
        .switch-root {
            width: 44px;
            height: 24px;
            background-color: hsl(var(--input));
            border-radius: 9999px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .switch-root[data-state="checked"] {
            background-color: hsl(var(--primary));
        }
        .switch-thumb {
            display: block;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 9999px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transform: translateX(2px) translateY(2px);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .switch-root[data-state="checked"] .switch-thumb {
            transform: translateX(22px) translateY(2px);
        }

        /* Diplomat Styles */
        .is-diplomat .tax-row {
            opacity: 0.3;
            text-decoration: line-through;
            pointer-events: none;
        }
        .is-diplomat .tax-row.active {
            opacity: 1;
            text-decoration: none;
            color: hsl(var(--primary));
        }
    </style>
</head>
<body>

    <div class="card-shell" id="app">
        
        <div class="px-6 py-5 border-b border-zinc-100 flex items-center justify-between bg-white/50 backdrop-blur-sm sticky top-0 z-10">
            <div class="flex items-center gap-2.5">
                <div class="bg-zinc-900 text-white p-1 rounded-md">
                    <i data-lucide="calculator" class="w-3.5 h-3.5"></i>
                </div>
                <span class="text-sm font-semibold tracking-tight text-zinc-900">Settlement</span>
            </div>
            
            <div class="flex items-center gap-3">
                <label class="text-[11px] font-medium text-zinc-500 uppercase tracking-wider cursor-pointer" for="modeSwitch">Diplomat</label>
                <div class="switch-root" id="modeSwitch" data-state="unchecked" onclick="toggleMode()">
                    <span class="switch-thumb"></span>
                </div>
            </div>
        </div>

        <div class="content-scroll">
            <div class="p-6 space-y-8">
                
                <div class="space-y-1 text-center py-4">
                    <p class="text-sm font-medium text-zinc-400 uppercase tracking-widest">Total Payable</p>
                    <h1 class="text-6xl font-bold tracking-tighter text-zinc-900 tabular" id="heroTotal">0.00</h1>
                    <div id="badgeContainer" class="h-6 flex justify-center items-center opacity-0 transition-opacity duration-300">
                        <span class="inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2.5 py-0.5 text-xs font-semibold text-emerald-700">
                            Exempt Active
                        </span>
                    </div>
                </div>

                <div class="grid gap-5">
                    <div class="space-y-2">
                        <label class="text-xs font-medium text-zinc-500 ml-1">Bill Amount</label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 font-medium text-sm">LKR</span>
                            <input type="number" id="baseIn" placeholder="0.00" inputmode="decimal" oninput="calculate()" class="shadcn-input pl-12 font-semibold text-lg text-zinc-900">
                        </div>
                    </div>

                    <div class="space-y-2">
                        <div class="flex justify-between items-center px-1">
                            <label class="text-xs font-medium text-zinc-500">Discount</label>
                            <button onclick="toggleDiscMode()" id="discToggle" class="text-[10px] font-bold bg-zinc-100 hover:bg-zinc-200 text-zinc-600 px-2 py-0.5 rounded transition-colors">% Mode</button>
                        </div>
                        <input type="number" id="discIn" placeholder="Optional" inputmode="decimal" oninput="calculate()" class="shadcn-input font-medium text-zinc-900">
                    </div>
                </div>

                <div class="pt-4 border-t border-zinc-100">
                    <div id="discRow" class="hidden flex justify-between items-center py-2 mb-2 text-rose-600 bg-rose-50/50 px-2 rounded-md border border-rose-100/50">
                        <span class="text-xs font-semibold">Discount Applied</span>
                        <span class="text-xs font-bold tabular">-<span id="discDisplay">0.00</span></span>
                    </div>

                    <div class="flex justify-between items-center py-2 px-1">
                        <span class="text-xs font-semibold text-zinc-700">Net / Tax Base</span>
                        <span id="subDisplay" class="text-sm font-semibold tabular text-zinc-900">0.00</span>
                    </div>

                    <button onclick="toggleDetails()" class="w-full flex items-center justify-between py-2 px-1 group mt-2">
                        <span class="text-xs font-medium text-zinc-400 group-hover:text-zinc-700 transition-colors flex items-center gap-1.5">
                            Tax Breakdown
                            <i id="chevron" data-lucide="chevron-down" class="w-3 h-3 transition-transform duration-300"></i>
                        </span>
                        <div class="h-px flex-1 bg-zinc-100 mx-3"></div>
                        <span id="taxTotalDisplay" class="text-xs font-medium text-zinc-400 tabular group-hover:text-zinc-700 transition-colors">0.00</span>
                    </button>

                    <div id="taxDetails" class="accordion-content">
                        <div class="accordion-inner pt-1 pb-2 space-y-2 px-1">
                            <div class="flex justify-between text-xs text-zinc-500 tax-row">
                                <span>Service Charge (10%)</span>
                                <span id="scVal" class="tabular font-medium text-zinc-700">0.00</span>
                            </div>
                            <div class="flex justify-between text-xs text-zinc-500 tax-row">
                                <span>TDL (1.04%)</span>
                                <span id="tdlVal" class="tabular font-medium text-zinc-700">0.00</span>
                            </div>
                            <div class="flex justify-between text-xs text-zinc-500 tax-row transition-opacity duration-300">
                                <span>SSCL (2.56%)</span>
                                <span id="sscVal" class="tabular font-medium text-zinc-700">0.00</span>
                            </div>
                            <div class="flex justify-between text-xs text-zinc-500 tax-row transition-opacity duration-300">
                                <span>VAT (18%)</span>
                                <span id="vatVal" class="tabular font-medium text-zinc-700">0.00</span>
                            </div>
                        </div>
                    </div>

                    <div id="savingsRow" class="hidden mt-4 pt-3 border-t border-dashed border-emerald-200">
                        <div class="flex justify-between items-center text-emerald-600">
                            <span class="text-xs font-bold uppercase tracking-wider">Diplomatic Waiver</span>
                            <span id="waivedVal" class="text-sm font-bold tabular">0.00</span>
                        </div>
                    </div>

                </div>
            </div>
            
            <div class="p-6 pt-0 mt-auto">
                <button onclick="resetAll()" class="w-full h-10 rounded-md border border-zinc-200 bg-white text-xs font-semibold text-zinc-600 hover:bg-zinc-50 hover:text-zinc-900 transition-all focus:ring-2 focus:ring-zinc-900 focus:ring-offset-2 outline-none">
                    Start New Settlement
                </button>
                <div class="text-center mt-4">
                     <p class="text-[10px] text-zinc-300 font-medium uppercase tracking-[0.2em]">Designed by Gavin</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        
        // State
        let state = {
            base: 0,
            discountInput: 0,
            discountMode: 'pct', // 'pct' or 'lkr'
            isDiplomat: false,
            detailsOpen: false
        };

        // DOM Elements
        const els = {
            app: document.getElementById('app'),
            switch: document.getElementById('modeSwitch'),
            badge: document.getElementById('badgeContainer'),
            discRow: document.getElementById('discRow'),
            details: document.getElementById('taxDetails'),
            chevron: document.getElementById('chevron'),
            savings: document.getElementById('savingsRow'),
            discToggle: document.getElementById('discToggle')
        };

        // Actions
        function toggleMode() {
            state.isDiplomat = !state.isDiplomat;
            
            // UI Updates for Switch
            if (state.isDiplomat) {
                els.switch.dataset.state = "checked";
                els.app.classList.add('is-diplomat');
                els.badge.classList.remove('opacity-0');
                els.savings.classList.remove('hidden');
                // Auto open details to show struck-through taxes for clarity
                if(!state.detailsOpen) toggleDetails();
            } else {
                els.switch.dataset.state = "unchecked";
                els.app.classList.remove('is-diplomat');
                els.badge.classList.add('opacity-0');
                els.savings.classList.add('hidden');
            }
            calculate();
        }

        function toggleDiscMode() {
            state.discountMode = state.discountMode === 'pct' ? 'lkr' : 'pct';
            els.discToggle.innerText = state.discountMode === 'pct' ? '% Mode' : 'LKR Mode';
            calculate();
        }

        function toggleDetails() {
            state.detailsOpen = !state.detailsOpen;
            if (state.detailsOpen) {
                els.details.classList.add('open');
                els.chevron.style.transform = 'rotate(180deg)';
            } else {
                els.details.classList.remove('open');
                els.chevron.style.transform = 'rotate(0deg)';
            }
        }

        function resetAll() {
            document.getElementById('baseIn').value = '';
            document.getElementById('discIn').value = '';
            state.base = 0;
            state.discountInput = 0;
            if(state.isDiplomat) toggleMode(); // Reset to standard
            if(state.detailsOpen) toggleDetails(); // Close details
            calculate();
        }

        function format(num) {
            return new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(num);
        }

        function calculate() {
            state.base = parseFloat(document.getElementById('baseIn').value) || 0;
            state.discountInput = parseFloat(document.getElementById('discIn').value) || 0;

            // 1. Calculate Discount
            let discountValue = 0;
            if (state.base > 0 && state.discountInput > 0) {
                if (state.discountMode === 'pct') {
                    discountValue = state.base * (Math.min(state.discountInput, 100) / 100);
                } else {
                    discountValue = Math.min(state.discountInput, state.base);
                }
            }

            // UI: Show/Hide Discount Row
            if (discountValue > 0) {
                els.discRow.classList.remove('hidden');
                document.getElementById('discDisplay').innerText = format(discountValue);
            } else {
                els.discRow.classList.add('hidden');
            }

            const subtotal = state.base - discountValue;
            document.getElementById('subDisplay').innerText = format(subtotal);

            // 2. Tax Logic (Sri Lanka Hospitality Standard)
            // Logic: SC(10%) and TDL(1%) are on Subtotal.
            // SSCL(2.5%) is on (Subtotal + SC + TDL) -- wait, standard practice usually excludes TDL from VAT/SSCL base, but TDL is often part of turnover. 
            // *Correction based on standard hotel chains:*
            // SC = 10% of Base
            // TDL = 1% (approx) of Base (technically 1/99 in some calculations, but usually straight %)
            // SSCL base = Base + SC
            // VAT base = Base + SC + SSCL
            
            // Let's stick to the previous arithmetic provided in context which seemed validated:
            const sc = subtotal * 0.10;
            const tdl = subtotal * 0.0104; // Specific rate provided
            const ssc = (subtotal + sc) * 0.025641;
            const vat = (subtotal + sc + ssc) * 0.18;

            // Update DOM Tax Values
            document.getElementById('scVal').innerText = format(sc);
            document.getElementById('tdlVal').innerText = format(tdl);
            document.getElementById('sscVal').innerText = format(ssc);
            document.getElementById('vatVal').innerText = format(vat);

            // 3. Final Total Logic
            let grandTotal = 0;
            let taxesSum = 0;

            if (state.isDiplomat) {
                // Diplomat pays: Subtotal + SC + TDL. (SSCL & VAT Waived)
                grandTotal = subtotal + sc + tdl;
                taxesSum = sc + tdl; // What they are paying in "extras"
                document.getElementById('waivedVal').innerText = format(ssc + vat);
            } else {
                // Standard pays everything
                grandTotal = subtotal + sc + tdl + ssc + vat;
                taxesSum = sc + tdl + ssc + vat;
            }

            document.getElementById('heroTotal').innerText = format(grandTotal);
            document.getElementById('taxTotalDisplay').innerText = `+ ${format(taxesSum)}`;
        }
    </script>
</body>
</html>
