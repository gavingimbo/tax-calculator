<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Minimal Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Core Structure */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: #09090b;
            overflow: hidden;
            height: 100dvh;
            /* Disable native interactions for terminal feel */
            -webkit-touch-callout: none; 
            -webkit-user-select: none; 
            user-select: none; touch-action: none;
        }

        .terminal-grid {
            display: grid;
            /* Fixed keypad height, rest for display */
            grid-template-rows: 1fr auto;
            height: 100%;
            max-width: 420px; /* Slightly tighter width for minimal feel */
            margin: 0 auto;
        }

        /* ZONE 1: Display Area (Top) */
        .display-zone {
            padding: 1.5rem 1.5rem 0.5rem;
            display: flex;
            flex-direction: column;
            /* Ensure content is vertically balanced */
            justify-content: space-evenly; 
        }

        .tabular { font-variant-numeric: tabular-nums; }
        
        /* State Transition Styles */
        .diplomat-active .total-display { color: #10b981; /* Emerald-500 */ }
        .diplomat-active .tax-row.exempt { opacity: 0.3; text-decoration: line-through; }

        /* Compact Breakdown Styling */
        .compact-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            font-size: 0.8rem;
            padding: 0.3rem 0;
        }
        .compact-label { color: #71717a; font-weight: 500; }
        .compact-value { font-weight: 600; }

        /* Tappable Input Displays */
        .input-display {
            background: #fafafa;
            border: 1px solid #e4e4e7;
            border-radius: 10px;
            padding: 0.75rem;
            transition: all 0.15s ease;
        }
        .input-display.active {
            background: #ffffff;
            border-color: #09090b;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
        }

        /* ZONE 2: Keypad Area (Bottom) */
        .keypad-zone {
            background: #fafafa;
            border-top: 1px solid #f4f4f5;
            padding: 0.75rem 1rem calc(0.75rem + env(safe-area-inset-bottom));
        }

        .key-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        
        .key-btn {
            background: #ffffff;
            border: 1px solid #e4e4e7;
            /* Shorter keys for minimal look */
            height: 52px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 600;
            color: #09090b;
            box-shadow: 0 1px 1px rgba(0,0,0,0.03);
        }
        .key-btn:active { background: #f4f4f5; transform: scale(0.97); }
        .key-btn.secondary { background: #f4f4f5; color: #52525b; font-size: 0.9rem; font-weight: 700; }

        /* Toggle Switch */
        .mode-toggle { background: #f4f4f5; padding: 3px; border-radius: 10px; display: flex; }
        .toggle-item { flex: 1; text-align: center; padding: 6px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; color: #71717a; border-radius: 8px; transition: all 0.2s; }
        .toggle-item.active { background: #ffffff; color: #09090b; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

    <div class="terminal-grid" id="terminalApp">
        <div class="display-zone">
            <div class="flex justify-between items-center opacity-40">
                <span class="text-[9px] font-bold uppercase tracking-[0.2em]">Secure Terminal</span>
                <i data-lucide="lock" class="w-3 h-3"></i>
            </div>

            <div class="text-center space-y-1 py-2">
                <div class="flex items-baseline justify-center gap-1 total-display transition-colors duration-300">
                    <span id="grandTotal" class="text-5xl font-extrabold tracking-tighter tabular">0.00</span>
                    <span class="text-sm font-bold opacity-50">LKR</span>
                </div>
                <div id="statusPill" class="inline-flex items-center gap-1 bg-zinc-100 px-2 py-0.5 rounded-full">
                    <span class="text-[9px] font-bold uppercase text-zinc-500">Standard Rate</span>
                </div>
            </div>

            <div class="space-y-3">
                <div class="mode-toggle">
                    <div id="togStandard" onclick="setGuest('standard')" class="toggle-item active">Standard Guest</div>
                    <div id="togDiplomat" onclick="setGuest('diplomat')" class="toggle-item">Diplomat Exempt</div>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <div id="dispBase" onclick="setActive('base')" class="input-display active">
                        <p class="text-[8px] font-bold uppercase text-zinc-400 mb-0.5">Base Value</p>
                        <p id="valBase" class="text-lg font-bold tabular">0</p>
                    </div>
                    <div id="dispDisc" onclick="setActive('disc')" class="input-display">
                        <div class="flex justify-between items-center mb-0.5">
                            <p class="text-[8px] font-bold uppercase text-zinc-400">Discount</p>
                            <p id="discTypeLabel" class="text-[8px] font-bold text-zinc-400 bg-zinc-100 px-1 rounded">%</p>
                        </div>
                        <p id="valDisc" class="text-lg font-bold tabular">0</p>
                    </div>
                </div>
            </div>

            <div class="pt-2 border-t border-zinc-50">
                 <div class="compact-row">
                    <span class="compact-label">Subtotal (After Discount)</span>
                    <span id="subtotalVal" class="compact-value tabular opacity-60">0.00</span>
                </div>
                <div class="compact-row">
                    <span class="compact-label">Service Charge (10%)</span>
                    <span id="scVal" class="compact-value tabular">0.00</span>
                </div>
                <div class="compact-row">
                    <span class="compact-label">TDL (1.04%)</span>
                    <span id="tdlVal" class="compact-value tabular">0.00</span>
                </div>
                <div class="compact-row tax-row transition-all duration-300">
                    <span class="compact-label">SSCL (2.564%)</span>
                    <span id="sscVal" class="compact-value tabular">0.00</span>
                </div>
                <div class="compact-row tax-row transition-all duration-300">
                    <span class="compact-label">VAT (18%)</span>
                    <span id="vatVal" class="compact-value tabular">0.00</span>
                </div>
            </div>
        </div>

        <div class="keypad-zone">
            <div class="key-grid">
                <button class="key-btn" onclick="press('1')">1</button>
                <button class="key-btn" onclick="press('2')">2</button>
                <button class="key-btn" onclick="press('3')">3</button>
                <button class="key-btn" onclick="press('4')">4</button>
                <button class="key-btn" onclick="press('5')">5</button>
                <button class="key-btn" onclick="press('6')">6</button>
                <button class="key-btn" onclick="press('7')">7</button>
                <button class="key-btn" onclick="press('8')">8</button>
                <button class="key-btn" onclick="press('9')">9</button>
                <button class="key-btn secondary" onclick="toggleDiscType()">% / LKR</button>
                <button class="key-btn" onclick="press('0')">0</button>
                <button class="key-btn secondary" onclick="press('del')"><i data-lucide="delete" class="w-5 h-5"></i></button>
            </div>
             <div class="text-center mt-3 opacity-30">
                <p class="text-[8px] font-bold uppercase tracking-widest">Gavin Matthew. Local Computation.</p>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        // State
        let activeInput = 'base';
        let baseStr = '0';
        let discStr = '0';
        let discType = 'pct'; // pct | fixed
        let isDiplomat = false;

        function setActive(target) {
            activeInput = target;
            document.getElementById('dispBase').classList.toggle('active', target === 'base');
            document.getElementById('dispDisc').classList.toggle('active', target === 'disc');
        }

        function setGuest(mode) {
            isDiplomat = mode === 'diplomat';
            document.getElementById('togStandard').classList.toggle('active', !isDiplomat);
            document.getElementById('togDiplomat').classList.toggle('active', isDiplomat);
            document.getElementById('terminalApp').classList.toggle('diplomat-active', isDiplomat);
            calculate();
        }

        function toggleDiscType() {
            discType = discType === 'pct' ? 'fixed' : 'pct';
            document.getElementById('discTypeLabel').innerText = discType === 'pct' ? '%' : 'LKR';
            calculate();
        }

        function press(key) {
            let targetStr = activeInput === 'base' ? baseStr : discStr;

            if (key === 'del') {
                targetStr = targetStr.slice(0, -1);
                if (targetStr === '') targetStr = '0';
            } else {
                if (targetStr === '0') targetStr = key;
                else if (targetStr.length < 8) targetStr += key; // Max 8 digits for minimal UI
            }

            if (activeInput === 'base') baseStr = targetStr;
            else discStr = targetStr;

            // Update displays immediately
            document.getElementById('valBase').innerText = Number(baseStr).toLocaleString();
            document.getElementById('valDisc').innerText = Number(discStr).toLocaleString();
            calculate();
        }

        function format(num) {
             return new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(num);
        }

        function calculate() {
            const b = parseFloat(baseStr) || 0;
            const dInput = parseFloat(discStr) || 0;

            // --- LOGIC: 100% Discount Cap ---
            let finalDiscountAmount = 0;
            if (discType === 'pct') {
                // Cap percentage at 100%
                const effectivePct = Math.min(dInput, 100);
                finalDiscountAmount = b * (effectivePct / 100);
            } else {
                // Cap fixed amount at base value
                finalDiscountAmount = Math.min(dInput, b);
            }

            const taxable = b - finalDiscountAmount;

            // Tax Math (Standard Hospitality Cascading)
            const sc = taxable * 0.10;
            const tdl = taxable * 0.0104;
            const ssc = (taxable + sc) * 0.025641;
            const vat = (taxable + sc + ssc) * 0.18;

            // Update Breakdown
            document.getElementById('subtotalVal').innerText = format(taxable);
            document.getElementById('scVal').innerText = format(sc);
            document.getElementById('tdlVal').innerText = format(tdl);
            document.getElementById('sscVal').innerText = format(ssc);
            document.getElementById('vatVal').innerText = format(vat);

            // Final Totals & Status Update
            let total = 0;
            const statusPill = document.getElementById('statusPill');

            if (isDiplomat) {
                total = taxable + sc + tdl;
                const saved = ssc + vat;
                // Transform status pill for Diplomat
                statusPill.className = "inline-flex items-center gap-1 bg-emerald-100 px-2 py-0.5 rounded-full text-emerald-700";
                statusPill.innerHTML = `<i data-lucide="check-circle" class="w-3 h-3"></i><span class="text-[9px] font-bold uppercase">Saved ${format(saved)} LKR</span>`;
                lucide.createIcons(); // Re-render icon
            } else {
                total = taxable + sc + tdl + ssc + vat;
                // Reset status pill
                statusPill.className = "inline-flex items-center gap-1 bg-zinc-100 px-2 py-0.5 rounded-full";
                statusPill.innerHTML = `<span class="text-[9px] font-bold uppercase text-zinc-500">Standard Rate</span>`;
            }

            document.getElementById('grandTotal').innerText = format(total);
        }
    </script>
</body>
</html>
