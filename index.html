<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Calculator | Professional System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root { --ring: rgba(9, 9, 11, 0.1); }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: #09090b;
            -webkit-font-smoothing: antialiased;
            /* Prevents the "stuck" feeling on mobile scroll */
            overflow-y: auto; 
            overscroll-behavior-y: none;
        }
        .premium-card {
            background: #ffffff;
            border: 1px solid #f4f4f5;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .input-pill {
            background: #fbfbfb;
            border: 1px solid #e4e4e7;
            border-radius: 14px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .input-pill:focus-within {
            background: #ffffff;
            border-color: #09090b;
            box-shadow: 0 0 0 2px var(--ring);
        }
        .segmented-bg {
            background-color: #f4f4f5;
            padding: 3px;
            border-radius: 14px;
            display: flex;
        }
        .segmented-item {
            flex: 1;
            padding: 0.6rem;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            text-align: center;
            border-radius: 11px;
            transition: all 0.2s ease;
            color: #71717a;
        }
        .segmented-item.active {
            background: white;
            color: #09090b;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        /* Numerical Inputs: Remove spinners */
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { 
            -webkit-appearance: none; margin: 0; 
        }
        .btn-press:active { transform: scale(0.96); }
        
        /* Sticky logic for mobile console */
        .sticky-console {
            position: sticky;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid #f4f4f5;
            padding-bottom: env(safe-area-inset-bottom);
        }
    </style>
</head>
<body class="min-h-[100dvh] flex flex-col">

    <div class="flex-1 px-6 pt-10 pb-6 max-w-md mx-auto w-full">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-lg font-extrabold tracking-tight">Calculator</h1>
            <div class="flex items-center gap-1 bg-zinc-100 px-2 py-1 rounded-full">
                <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></div>
                <span class="text-[9px] font-bold text-zinc-500 uppercase tracking-widest">Live</span>
            </div>
        </header>

        <div class="space-y-10">
            <section class="text-center">
                <p class="text-[10px] font-black text-zinc-400 uppercase tracking-[0.2em] mb-2">Net Total Amount</p>
                <div class="flex items-baseline justify-center gap-2">
                    <span id="grandTotal" class="text-6xl font-extrabold tracking-tighter tabular-nums">0.00</span>
                    <span class="text-sm font-bold text-zinc-300">LKR</span>
                </div>
            </section>

            <section class="space-y-4">
                <div class="flex justify-between items-center text-sm">
                    <span class="text-zinc-500 font-medium">Taxable Subtotal</span>
                    <span id="summarySub" class="font-bold tabular-nums">0.00</span>
                </div>
                
                <div class="h-[1px] bg-zinc-50 w-full"></div>

                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-zinc-400">Service Charge (10%)</span>
                        <span id="summarySC" class="text-xs font-semibold tabular-nums">0.00</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-zinc-400">TDL (1.04%)</span>
                        <span id="summaryTDL" class="text-xs font-semibold tabular-nums">0.00</span>
                    </div>
                    <div id="sscRow" class="flex justify-between items-center">
                        <span class="text-xs text-zinc-400">SSCL (2.5641%)</span>
                        <span id="summarySSC" class="text-xs font-semibold tabular-nums">0.00</span>
                    </div>
                    <div id="vatRow" class="flex justify-between items-center">
                        <span class="text-xs text-zinc-400">VAT (18%)</span>
                        <span id="summaryVAT" class="text-xs font-semibold tabular-nums">0.00</span>
                    </div>
                </div>
            </section>

            <section id="diplomatCard" class="hidden animate-in fade-in slide-in-from-bottom-2 duration-300">
                <div class="bg-zinc-900 rounded-[2rem] p-6 text-white overflow-hidden relative shadow-lg">
                    <p class="text-[9px] font-black uppercase tracking-[0.2em] text-zinc-500 mb-4">Exemption Summary</p>
                    <div class="flex justify-between items-end">
                        <div>
                            <p class="text-[10px] text-zinc-400 mb-1">VAT + SSC Saved</p>
                            <p id="exTotal" class="text-2xl font-bold">0.00 LKR</p>
                        </div>
                        <i data-lucide="shield-check" class="w-8 h-8 opacity-20"></i>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <div class="sticky-console px-6 py-6 w-full">
        <div class="max-w-md mx-auto space-y-4">
            
            <div class="segmented-bg">
                <button onclick="setGuest('standard')" id="btnStandard" class="segmented-item active">Standard Guest</button>
                <button onclick="setGuest('diplomat')" id="btnDiplomat" class="segmented-item">Diplomat Exempt</button>
            </div>

            <div class="grid grid-cols-12 gap-2">
                <div class="col-span-8 input-pill px-4 py-3 flex items-center">
                    <span class="text-[10px] font-bold text-zinc-400 mr-3 border-r pr-2 border-zinc-200">LKR</span>
                    <input 
                        type="number" 
                        id="baseInput" 
                        inputmode="decimal"
                        oninput="updateUI()"
                        placeholder="Base Value" 
                        class="w-full bg-transparent outline-none font-bold text-lg placeholder:text-zinc-200"
                    >
                </div>
                <button onclick="toggleDiscType()" id="typeBtn" class="col-span-4 input-pill flex items-center justify-center font-black text-xs btn-press bg-white">
                    PERCENT %
                </button>
            </div>

            <div class="flex gap-2">
                <div class="flex-1 input-pill px-4 py-3 flex items-center">
                    <i data-lucide="tag" class="w-3.5 h-3.5 text-zinc-400 mr-2"></i>
                    <input 
                        type="number" 
                        id="customDiscount" 
                        inputmode="decimal"
                        oninput="updateUI()"
                        placeholder="Discount value" 
                        class="w-full bg-transparent outline-none font-semibold text-sm"
                    >
                </div>
                <button onclick="resetInputs()" class="w-12 h-12 rounded-[14px] bg-zinc-100 flex items-center justify-center btn-press">
                    <i data-lucide="rotate-ccw" class="w-4 h-4 text-zinc-400"></i>
                </button>
            </div>

            <footer class="text-center pt-2">
                <p class="text-[9px] font-bold text-zinc-300 uppercase tracking-widest leading-none">
                    Gavin Matthew. Secure local computation.
                </p>
            </footer>
        </div>
    </div>

    <script>
        lucide.createIcons();

        let guestType = 'standard';
        let discountType = 'pct';

        function setGuest(type) {
            guestType = type;
            document.getElementById('btnStandard').classList.toggle('active', type === 'standard');
            document.getElementById('btnDiplomat').classList.toggle('active', type === 'diplomat');
            
            const sscRow = document.getElementById('sscRow');
            const vatRow = document.getElementById('vatRow');
            const diplomatCard = document.getElementById('diplomatCard');

            if(type === 'diplomat') {
                sscRow.style.opacity = '0.15';
                vatRow.style.opacity = '0.15';
                diplomatCard.classList.remove('hidden');
            } else {
                sscRow.style.opacity = '1';
                vatRow.style.opacity = '1';
                diplomatCard.classList.add('hidden');
            }
            updateUI();
        }

        function toggleDiscType() {
            discountType = (discountType === 'pct') ? 'lkr' : 'pct';
            document.getElementById('typeBtn').innerText = (discountType === 'pct') ? 'PERCENT %' : 'FIXED LKR';
            updateUI();
        }

        function resetInputs() {
            document.getElementById('baseInput').value = '';
            document.getElementById('customDiscount').value = '';
            updateUI();
        }

        function format(num) {
            return new Intl.NumberFormat('en-US', { 
                minimumFractionDigits: 2, 
                maximumFractionDigits: 2 
            }).format(num);
        }

        function updateUI() {
            const base = parseFloat(document.getElementById('baseInput').value) || 0;
            const discInput = parseFloat(document.getElementById('customDiscount').value) || 0;

            let discVal = (discountType === 'pct') ? base * (discInput / 100) : discInput;
            const taxableBase = Math.max(0, base - discVal);
            
            // Core Tax Math
            const sc = taxableBase * 0.10;
            const tdl = taxableBase * 0.0104;
            const ssc = (taxableBase + sc) * 0.025641;
            const vat = (taxableBase + sc + ssc) * 0.18;

            // Display Update
            document.getElementById('summarySub').innerText = format(taxableBase);
            document.getElementById('summarySC').innerText = format(sc);
            document.getElementById('summaryTDL').innerText = format(tdl);
            document.getElementById('summarySSC').innerText = format(ssc);
            document.getElementById('summaryVAT').innerText = format(vat);

            let total = 0;
            if (guestType === 'standard') {
                total = taxableBase + sc + tdl + ssc + vat;
            } else {
                total = taxableBase + sc + tdl;
                document.getElementById('exTotal').innerText = format(vat + ssc) + ' LKR';
            }

            document.getElementById('grandTotal').innerText = format(total);
        }

        // Handle mobile keyboard resize gracefully
        window.visualViewport.addEventListener('resize', () => {
            // This ensures the console stays above the keyboard on Android/Chrome
            document.body.style.height = window.visualViewport.height + 'px';
        });
    </script>
</body>
</html>
